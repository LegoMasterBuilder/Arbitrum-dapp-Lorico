{
  "version": 3,
  "sources": ["../../.pnpm/htmlnano@2.1.1_postcss@8.4.38_terser@5.31.1_typescript@5.4.5/node_modules/htmlnano/lib/modules/minifyCss.mjs"],
  "sourcesContent": ["import { isStyleNode, extractCssFromStyleNode, optionalImport } from '../helpers.mjs';\n\nconst postcssOptions = {\n    // Prevent the following warning from being shown:\n    // > Without `from` option PostCSS could generate wrong source map and will not find Browserslist config.\n    // > Set it to CSS file path or to `undefined` to prevent this warning.\n    from: undefined,\n};\n\n/** Minify CSS with cssnano */\nexport default async function minifyCss(tree, options, cssnanoOptions) {\n    const cssnano = await optionalImport('cssnano');\n    const postcss = await optionalImport('postcss');\n\n    if (!cssnano || !postcss) {\n        return tree;\n    }\n\n    let promises = [];\n    tree.walk(node => {\n        // Skip SRI, reasons are documented in \"minifyJs\" module\n        if (node.attrs && 'integrity' in node.attrs) {\n            return node;\n        }\n\n        if (isStyleNode(node)) {\n            promises.push(processStyleNode(node, cssnanoOptions, cssnano, postcss));\n        } else if (node.attrs && node.attrs.style) {\n            promises.push(processStyleAttr(node, cssnanoOptions, cssnano, postcss));\n        }\n\n        return node;\n    });\n\n    return Promise.all(promises).then(() => tree);\n}\n\n\nfunction processStyleNode(styleNode, cssnanoOptions, cssnano, postcss) {\n    let css = extractCssFromStyleNode(styleNode);\n\n    // Improve performance by avoiding calling stripCdata again and again\n    let isCdataWrapped = false;\n    if (css.includes('CDATA')) {\n        const strippedCss = stripCdata(css);\n        isCdataWrapped = css !== strippedCss;\n        css = strippedCss;\n    }\n\n    return postcss([cssnano(cssnanoOptions)])\n        .process(css, postcssOptions)\n        .then(result => {\n            if (isCdataWrapped) {\n                return styleNode.content = ['<![CDATA[' + result + ']]>'];\n            }\n            return styleNode.content = [result.css];\n        });\n}\n\n\nfunction processStyleAttr(node, cssnanoOptions, cssnano, postcss) {\n    // CSS \"color: red;\" is invalid. Therefore it should be wrapped inside some selector:\n    // a{color: red;}\n    const wrapperStart = 'a{';\n    const wrapperEnd = '}';\n    const wrappedStyle = wrapperStart + (node.attrs.style || '') + wrapperEnd;\n\n    return postcss([cssnano(cssnanoOptions)])\n        .process(wrappedStyle, postcssOptions)\n        .then(result => {\n            const minifiedCss = result.css;\n            // Remove wrapperStart at the start and wrapperEnd at the end of minifiedCss\n            node.attrs.style = minifiedCss.substring(\n                wrapperStart.length,\n                minifiedCss.length - wrapperEnd.length\n            );\n        });\n}\n\nfunction stripCdata(css) {\n    const leftStrippedCss = css.replace('<![CDATA[', '');\n    if (leftStrippedCss === css) {\n        return css;\n    }\n\n    const strippedCss = leftStrippedCss.replace(']]>', '');\n    return leftStrippedCss === strippedCss ? css : strippedCss;\n}\n"],
  "mappings": ";;;;;;;;AAEA,IAAM,iBAAiB;AAAA;AAAA;AAAA;AAAA,EAInB,MAAM;AACV;AAGA,eAAO,UAAiC,MAAM,SAAS,gBAAgB;AACnE,QAAM,UAAU,MAAM,eAAe,SAAS;AAC9C,QAAM,UAAU,MAAM,eAAe,SAAS;AAE9C,MAAI,CAAC,WAAW,CAAC,SAAS;AACtB,WAAO;AAAA,EACX;AAEA,MAAI,WAAW,CAAC;AAChB,OAAK,KAAK,UAAQ;AAEd,QAAI,KAAK,SAAS,eAAe,KAAK,OAAO;AACzC,aAAO;AAAA,IACX;AAEA,QAAI,YAAY,IAAI,GAAG;AACnB,eAAS,KAAK,iBAAiB,MAAM,gBAAgB,SAAS,OAAO,CAAC;AAAA,IAC1E,WAAW,KAAK,SAAS,KAAK,MAAM,OAAO;AACvC,eAAS,KAAK,iBAAiB,MAAM,gBAAgB,SAAS,OAAO,CAAC;AAAA,IAC1E;AAEA,WAAO;AAAA,EACX,CAAC;AAED,SAAO,QAAQ,IAAI,QAAQ,EAAE,KAAK,MAAM,IAAI;AAChD;AAGA,SAAS,iBAAiB,WAAW,gBAAgB,SAAS,SAAS;AACnE,MAAI,MAAM,wBAAwB,SAAS;AAG3C,MAAI,iBAAiB;AACrB,MAAI,IAAI,SAAS,OAAO,GAAG;AACvB,UAAM,cAAc,WAAW,GAAG;AAClC,qBAAiB,QAAQ;AACzB,UAAM;AAAA,EACV;AAEA,SAAO,QAAQ,CAAC,QAAQ,cAAc,CAAC,CAAC,EACnC,QAAQ,KAAK,cAAc,EAC3B,KAAK,YAAU;AACZ,QAAI,gBAAgB;AAChB,aAAO,UAAU,UAAU,CAAC,cAAc,SAAS,KAAK;AAAA,IAC5D;AACA,WAAO,UAAU,UAAU,CAAC,OAAO,GAAG;AAAA,EAC1C,CAAC;AACT;AAGA,SAAS,iBAAiB,MAAM,gBAAgB,SAAS,SAAS;AAG9D,QAAM,eAAe;AACrB,QAAM,aAAa;AACnB,QAAM,eAAe,gBAAgB,KAAK,MAAM,SAAS,MAAM;AAE/D,SAAO,QAAQ,CAAC,QAAQ,cAAc,CAAC,CAAC,EACnC,QAAQ,cAAc,cAAc,EACpC,KAAK,YAAU;AACZ,UAAM,cAAc,OAAO;AAE3B,SAAK,MAAM,QAAQ,YAAY;AAAA,MAC3B,aAAa;AAAA,MACb,YAAY,SAAS,WAAW;AAAA,IACpC;AAAA,EACJ,CAAC;AACT;AAEA,SAAS,WAAW,KAAK;AACrB,QAAM,kBAAkB,IAAI,QAAQ,aAAa,EAAE;AACnD,MAAI,oBAAoB,KAAK;AACzB,WAAO;AAAA,EACX;AAEA,QAAM,cAAc,gBAAgB,QAAQ,OAAO,EAAE;AACrD,SAAO,oBAAoB,cAAc,MAAM;AACnD;",
  "names": []
}
